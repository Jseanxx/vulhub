FROM debian:unstable

# Install required packages
RUN apt-get update && apt-get install -y \
    build-essential \
    wget \
    openssh-server \
    git \
    && rm -rf /var/lib/apt/lists/*

# Configure SSH
RUN mkdir /var/run/sshd
RUN echo 'root:password' | chpasswd
RUN sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Download and build vulnerable XZ Utils
WORKDIR /tmp
RUN wget https://tukaani.org/xz/xz-5.6.1.tar.gz
RUN tar xf xz-5.6.1.tar.gz
WORKDIR /tmp/xz-5.6.1
RUN ./configure
RUN make
RUN make install

# Clean up
RUN rm -rf /tmp/xz-5.6.1*

# Set up exploit directory
WORKDIR /exploit

# Start SSH service
CMD ["/usr/sbin/sshd", "-D"] 